```bash
mkdir -p /root/files/keycloak
cd /root/files/keycloak

# Helm 저장소 추가 및 업데이트
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm repo list

helm pull bitnami/keycloak --version 24.4.9

tar -xvf keycloak-24.4.9.tgz

# kubectl delete ns keycloak
cat <<EOF | tee /root/files/keycloak/override_values.yaml
auth:
  adminUser: admin
  adminPassword: "admin"
tls:
  enabled: false
  autoGenerated: false
proxy: edge
postgresql:
  enabled: true     # external DB 사용할 경우 false로 변경
  auth:
    postgresPassword: "test123"
    username: admin_keycloak
    password: "test123"
    database: db_keycloak
  architecture: standalone
EOF

helm install keycloak keycloak-24.4.9.tgz  --namespace=keycloak --create-namespace -f /root/files/keycloak/override_values.yaml

# SSL 인증서 생성
# certbot certonly --manual --preferred-challenges dns -d keycloak.wooyoung85.net

ll /etc/letsencrypt/live/keycloak.wooyoung85.net/

kubectl create secret tls keycloak-tls-secret \
--key /etc/letsencrypt/live/keycloak.wooyoung85.net/privkey.pem \
--cert /etc/letsencrypt/live/keycloak.wooyoung85.net/fullchain.pem \
-n keycloak


kubectl get secret -n keycloak keycloak-tls-secret

# Ingress 설정 
cat <<EOF | tee ~/keycloak-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: keycloak-ingress
  namespace: keycloak
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /  # 요청 경로를 리다이렉트
spec:
  tls:
  - hosts:
    - keycloak.wooyoung85.net
    secretName: keycloak-tls-secret
  ingressClassName: "nginx"  # NGINX Ingress Controller 사용
  rules:
  - host: keycloak.wooyoung85.net
    http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: keycloak
            port:
              number: 80
EOF
kubectl apply -f ~/keycloak-ingress.yaml
```